// todo

// Tarefas para Refatoração do ConversationContext

- [x] **Estrutura Básica:**
  - [x] Criar `context/ConversationContext.tsx`.
  - [x] Definir `ConversationContextType`.
  - [x] Criar `ConversationProvider`.
  - [x] Criar hook `useConversationContext`.
- [x] **Gerenciamento de Estado:**
  - [x] Definir estados: `conversations`, `selectedConversation`, `selectedConversationMessages`, `messageCache`, `unreadConversationIds`.
  - [x] Definir estados de loading: `loadingConversations`, `loadingSelectedConversationMessages`.
  - [x] Definir estados de erro: `conversationsError`, `selectedConversationError`.
- [x] **Busca de Dados:**
  - [x] Implementar `fetchConversations(filter, workspaceId)`.
  - [x] Implementar `fetchConversationMessages(conversationId)` (com cache).
- [x] **Lógica de Seleção:**
  - [x] Implementar `selectConversation(conversation)` (atualiza estado, busca msgs, limpa não lido).
- [x] **Listener SSE:**
  - [x] Implementar `useEffect` com `EventSource` para `/api/sse?workspaceId=...`.
  - [x] Adicionar handlers `onopen` e `onerror` com logs.
  - [x] Implementar handler `onmessage`.
- [x] **Processamento de Eventos SSE:**
  - [x] Parse `event.data` em `onmessage`.
  - [x] Implementar `handleRealtimeNewMessage(message)`:
    - [x] Atualizar `messageCache`.
    - [x] Atualizar `selectedConversationMessages`.
    - [x] Atualizar `conversations` (mover existente OU adicionar novo otimisticamente).
    - [x] Atualizar `unreadConversationIds`.
  - [x] Implementar `handleRealtimeStatusUpdate(data)` (atualiza status em cache, msgs selecionadas, `last_message_status` na lista).
  - [ ] (Opcional) Implementar handlers para outros eventos (`ai_status_updated`, `message_content_updated`).
- [ ] **Ações do Usuário (Implementação Inicial - Será Server Action depois):**
  - [x] Recriar `sendManualMessage`.
  - [ ] Recriar `sendTemplateMessage`.
  - [ ] Recriar `sendMediaMessage`.
  - [ ] Recriar `toggleAIStatus`.
- [ ] **Finalização:**
  - [ ] Usar `useMemo` para o valor do contexto.
  - [ ] Usar `useCallback` apropriadamente (revisar dependências).
  - [ ] Adicionar funções auxiliares (ex: `clearMessagesError` já está básica).

