root@lumi-dev:~/app_follow-up#
root@lumi-dev:~/app_follow-up# npm run dev

> app_nextlumibot@0.1.0 dev
> next dev --turbopack

   ‚ñ≤ Next.js 15.2.0 (Turbopack)
   - Local:        http://localhost:3000
   - Network:      http://168.119.247.230:3000
   - Environments: .env.local, .env

 ‚úì Starting...
 ‚úì Ready in 1335ms
 ‚óã Compiling /api/follow-up ...
 ‚úì Compiled /api/follow-up in 1694ms
MODO DE TESTE CONFIGURADO COMO: ATIVADO
Processador de mensagens personalizado configurado.
Sistema de follow-up inicializado com integra√ß√£o da API Lumibot.
 POST /api/follow-up 201 in 2101ms
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Processando passo 0 (Etapa 1)
Modo de teste: convertendo tempo "30 minutos" para 30 segundos para testes
===== LOG DE AGENDAMENTO DE MENSAGEM =====
FollowUp ID: 813da06e-e3eb-40e1-92eb-12d15151fa3c
Step Index: 0
Cliente ID: 58
Conte√∫do: "Ei, Boss! üöÄ Vi que voc√™ recebeu a mensagem, mas ainda n√£o respondeu. Quer tirar alguma d√∫vida ante
Hor√°rio Agendado: 2025-03-24T23:50:56.151Z
Metadata: {
  "template_name": "novo_lead_10min",
  "category": "Utility",
  "stage_name": "Etapa 1",
  "clientName": "58",
  "templateParams": {
    "name": "novo_lead_10min",
    "category": "Utility",
    "language": "pt_BR"
  },
  "processedParams": {
    "1": "58"
  }
}
Atraso calculado: 29987ms (29.987 segundos)
Agendando mensagem para daqui a 29.987 segundos
Timeout armazenado com sucesso para mensagem 813da06e-e3eb-40e1-92eb-12d15151fa3c-0
Mensagem para o passo 0 agendada com sucesso
Pr√≥ximo passo: novo_lead_30min, tempo de espera: 30000ms
Agendando pr√≥ximo passo 1 para follow-up 813da06e-e3eb-40e1-92eb-12d15151fa3c com delay de 30000ms
Recarregando 1 follow-ups ativos com mensagens pendentes
===== LOG DE AGENDAMENTO DE MENSAGEM =====
FollowUp ID: 813da06e-e3eb-40e1-92eb-12d15151fa3c
Step Index: 0
Cliente ID: 58
Conte√∫do: "Ei, Boss! üöÄ Vi que voc√™ recebeu a mensagem, mas ainda n√£o respondeu. Quer tirar alguma d√∫vida ante
Hor√°rio Agendado: 2025-03-24T23:50:56.151Z
Metadata: {
  "template_name": "novo_lead_10min",
  "category": "Utility",
  "stage_name": "Etapa 1"
}
Cancelando timeout existente para mensagem 813da06e-e3eb-40e1-92eb-12d15151fa3c-0
Atraso calculado: 25173ms (25.173 segundos)
Agendando mensagem para daqui a 25.173 segundos
Timeout armazenado com sucesso para mensagem 813da06e-e3eb-40e1-92eb-12d15151fa3c-0
Reagendado envio da mensagem do passo 0 para follow-up 813da06e-e3eb-40e1-92eb-12d15151fa3c
Executando timeout para mensagem 813da06e-e3eb-40e1-92eb-12d15151fa3c-0
===== LOG DE ENVIO DE MENSAGEM =====
FollowUp ID: 813da06e-e3eb-40e1-92eb-12d15151fa3c
Step Index: 0
Cliente ID: 58
Status do follow-up: active
Enviando mensagem via API Lumibot
Template: novo_lead_10min
Categoria: Utility
===== REQUISI√á√ÉO GET CONVERSA DO CLIENTE =====
Cliente ID: 58
Endpoint: https://app.lumibot.com.br/api/v1/accounts/10/conversations/58
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Processando passo 1 (Etapa 1)
Modo de teste: convertendo tempo "30 minutos" para 30 segundos para testes
===== LOG DE AGENDAMENTO DE MENSAGEM =====
FollowUp ID: 813da06e-e3eb-40e1-92eb-12d15151fa3c
Step Index: 1
Cliente ID: 58
Conte√∫do: Oi, {{1}}! Percebi que seu atendimento ainda est√° em andamento. Sei que a rotina pode ser corrida, e
Hor√°rio Agendado: 2025-03-24T23:51:26.202Z
Metadata: {
  "template_name": "novo_lead_30min",
  "category": "Utility",
  "stage_name": "Etapa 1",
  "clientName": "58",
  "templateParams": {
    "name": "novo_lead_30min",
    "category": "Utility",
    "language": "pt_BR"
  },
  "processedParams": {
    "1": "58"
  }
}
Atraso calculado: 29991ms (29.991 segundos)
Agendando mensagem para daqui a 29.991 segundos
Timeout armazenado com sucesso para mensagem 813da06e-e3eb-40e1-92eb-12d15151fa3c-1
Mensagem para o passo 1 agendada com sucesso
Follow-up 813da06e-e3eb-40e1-92eb-12d15151fa3c - √öltimo passo do est√°gio, aguardando resposta antes de avan√ßar para Etapa 2
Follow-up 813da06e-e3eb-40e1-92eb-12d15151fa3c - Preparando transi√ß√£o para o pr√≥ximo est√°gio: Etapa 2
Follow-up 813da06e-e3eb-40e1-92eb-12d15151fa3c - Existem 2 mensagens pendentes no est√°gio "Etapa 1". Pausando para aguardar envio completo.
===== RESPOSTA GET CONVERSA DO CLIENTE =====
Status: 200
Detalhes do envio para Lumibot:
- clientId: 58
- templateName: novo_lead_10min
- category: Utility
===== RESPOSTA DA API LUMIBOT =====
Status: 200
Resultado do envio via Lumibot: SUCESSO
Atualizando mensagem como entregue no banco de dados
Mensagem marcada como entregue com sucesso
Timeout removido do mapa: 813da06e-e3eb-40e1-92eb-12d15151fa3c-0
Executando timeout para mensagem 813da06e-e3eb-40e1-92eb-12d15151fa3c-1
===== LOG DE ENVIO DE MENSAGEM =====
FollowUp ID: 813da06e-e3eb-40e1-92eb-12d15151fa3c
Step Index: 1
Cliente ID: 58
Status do follow-up: active
Enviando mensagem via API Lumibot
Template: novo_lead_30min
Categoria: Utility
===== REQUISI√á√ÉO GET CONVERSA DO CLIENTE =====
Cliente ID: 58
Endpoint: https://app.lumibot.com.br/api/v1/accounts/10/conversations/58
===== RESPOSTA GET CONVERSA DO CLIENTE =====
Status: 200
Detalhes do envio para Lumibot:
- clientId: 58
- templateName: novo_lead_30min
- category: Utility
===== RESPOSTA DA API LUMIBOT =====
Status: 200
Resultado do envio via Lumibot: SUCESSO
Atualizando mensagem como entregue no banco de dados
Mensagem marcada como entregue com sucesso
Timeout removido do mapa: 813da06e-e3eb-40e1-92eb-12d15151fa3c-1
 ‚óã Compiling /api/follow-up/client-response ...
 ‚úì Compiled /api/follow-up/client-response in 613ms
=== DADOS DA RESPOSTA DO CLIENTE ===
followUpId: 813da06e-e3eb-40e1-92eb-12d15151fa3c
clientId: 58
message: Ol√°, estou testando o avan√ßo de est√°gio!
=== FIM DADOS DA RESPOSTA DO CLIENTE ===
=== DADOS DA RESPOSTA DO CLIENTE === {
  followUpId: '813da06e-e3eb-40e1-92eb-12d15151fa3c',
  clientId: '58',
  message: 'Ol√°, estou testando o avan√ßo de est√°gio!'
}
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Est√°gio atual: Etapa 1 √≠ndice: 0
Cliente respondeu durante follow-up ativo. Avan√ßando para pr√≥ximo est√°gio: Etapa 2
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Processando passo 2 (Etapa 2)
Modo de teste: convertendo tempo "30 minutos" para 30 segundos para testes
===== LOG DE AGENDAMENTO DE MENSAGEM =====
FollowUp ID: 813da06e-e3eb-40e1-92eb-12d15151fa3c
Step Index: 2
Cliente ID: 58
Conte√∫do: Oi, {{1}}! Vi que voc√™ iniciou um processo conosco, mas ainda n√£o conclu√≠mos sua qualifica√ß√£o. Caso 
Hor√°rio Agendado: 2025-03-24T23:52:03.008Z
Metadata: {
  "template_name": "qualificacao_10min",
  "category": "Utility",
  "stage_name": "Etapa 2",
  "clientName": "58",
  "templateParams": {
    "name": "qualificacao_10min",
    "category": "Utility",
    "language": "pt_BR"
  },
  "processedParams": {
    "1": "58"
  }
}
Atraso calculado: 29994ms (29.994 segundos)
Agendando mensagem para daqui a 29.994 segundos
Timeout armazenado com sucesso para mensagem 813da06e-e3eb-40e1-92eb-12d15151fa3c-2
Mensagem para o passo 2 agendada com sucesso
Pr√≥ximo passo: qualificacao_1h, tempo de espera: 30000ms
Agendando pr√≥ximo passo 3 para follow-up 813da06e-e3eb-40e1-92eb-12d15151fa3c com delay de 30000ms
 POST /api/follow-up/client-response 200 in 746ms
 ‚óã Compiling /api/follow-up/status ...
 ‚úì Compiled /api/follow-up/status in 591ms
 GET /api/follow-up/status?id=813da06e-e3eb-40e1-92eb-12d15151fa3c 200 in 660ms
Executando timeout para mensagem 813da06e-e3eb-40e1-92eb-12d15151fa3c-2
===== LOG DE ENVIO DE MENSAGEM =====
FollowUp ID: 813da06e-e3eb-40e1-92eb-12d15151fa3c
Step Index: 2
Cliente ID: 58
Status do follow-up: active
Cliente j√° respondeu e mudou de fase, cancelando envio
Timeout removido do mapa: 813da06e-e3eb-40e1-92eb-12d15151fa3c-2
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Processando passo 3 (Etapa 2)
Modo de teste: convertendo tempo "30 minutos" para 30 segundos para testes
===== LOG DE AGENDAMENTO DE MENSAGEM =====
FollowUp ID: 813da06e-e3eb-40e1-92eb-12d15151fa3c
Step Index: 3
Cliente ID: 58
Conte√∫do: Boss! Para te ajudar com mais informa√ß√µes, preparamos um v√≠deo explicativo sobre como funciona. Voc√™
Hor√°rio Agendado: 2025-03-24T23:52:33.027Z
Metadata: {
  "template_name": "qualificacao_1h",
  "category": "Utility",
  "stage_name": "Etapa 2",
  "clientName": "58",
  "templateParams": {
    "name": "qualificacao_1h",
    "category": "Utility",
    "language": "pt_BR"
  },
  "processedParams": {
    "1": "58"
  }
}
Atraso calculado: 29992ms (29.992 segundos)
Agendando mensagem para daqui a 29.992 segundos
Timeout armazenado com sucesso para mensagem 813da06e-e3eb-40e1-92eb-12d15151fa3c-3
Mensagem para o passo 3 agendada com sucesso
Follow-up 813da06e-e3eb-40e1-92eb-12d15151fa3c - √öltimo passo do est√°gio, aguardando resposta antes de avan√ßar para Etapa 3
Follow-up 813da06e-e3eb-40e1-92eb-12d15151fa3c - Preparando transi√ß√£o para o pr√≥ximo est√°gio: Etapa 3
Follow-up 813da06e-e3eb-40e1-92eb-12d15151fa3c - Existem 2 mensagens pendentes no est√°gio "Etapa 2". Pausando para aguardar envio completo.
 GET /api/follow-up/status?id=813da06e-e3eb-40e1-92eb-12d15151fa3c 200 in 71ms
 GET /api/follow-up/status?id=813da06e-e3eb-40e1-92eb-12d15151fa3c 200 in 61ms
Executando timeout para mensagem 813da06e-e3eb-40e1-92eb-12d15151fa3c-3
===== LOG DE ENVIO DE MENSAGEM =====
FollowUp ID: 813da06e-e3eb-40e1-92eb-12d15151fa3c
Step Index: 3
Cliente ID: 58
Status do follow-up: active
Enviando mensagem via API Lumibot
Template: qualificacao_1h
Categoria: Utility
===== REQUISI√á√ÉO GET CONVERSA DO CLIENTE =====
Cliente ID: 58
Endpoint: https://app.lumibot.com.br/api/v1/accounts/10/conversations/58
===== RESPOSTA GET CONVERSA DO CLIENTE =====
Status: 200
Detalhes do envio para Lumibot:
- clientId: 58
- templateName: qualificacao_1h
- category: Utility
===== RESPOSTA DA API LUMIBOT =====
Status: 200
Resultado do envio via Lumibot: SUCESSO
Atualizando mensagem como entregue no banco de dados
Mensagem marcada como entregue com sucesso
Timeout removido do mapa: 813da06e-e3eb-40e1-92eb-12d15151fa3c-3
 GET /api/follow-up/status?id=813da06e-e3eb-40e1-92eb-12d15151fa3c 200 in 60ms
 GET /api/follow-up/status?id=813da06e-e3eb-40e1-92eb-12d15151fa3c 200 in 61ms
 GET /api/follow-up/status?id=813da06e-e3eb-40e1-92eb-12d15151fa3c 200 in 59ms
