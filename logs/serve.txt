root@lumi-dev:~/app_follow-up# npm run dev

> app_nextlumibot@0.1.0 dev
> next dev --turbopack

   ‚ñ≤ Next.js 15.2.0 (Turbopack)
   - Local:        http://localhost:3000
   - Network:      http://168.119.247.230:3000
   - Environments: .env.local, .env

 ‚úì Starting...
 ‚úì Ready in 1277ms
^[[A ‚óã Compiling /api/follow-up/cancel ...
 ‚úì Compiled /api/follow-up/cancel in 1575ms
 POST /api/follow-up/cancel 200 in 1972ms
 ‚óã Compiling /api/follow-up ...
 ‚úì Compiled /api/follow-up in 638ms
MODO DE TESTE CONFIGURADO COMO: ATIVADO
Processador de mensagens personalizado configurado.
Sistema de follow-up inicializado com integra√ß√£o da API Lumibot.
 POST /api/follow-up 201 in 778ms
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Processando passo 0 (Etapa 1)
Modo de teste: convertendo tempo "30 minutos" para 30 segundos para testes
===== LOG DE AGENDAMENTO DE MENSAGEM =====
FollowUp ID: 9c237132-0de0-4946-aba5-8ee21ea66e2e
Step Index: 0
Cliente ID: 58
Conte√∫do: "Ei, Boss! üöÄ Vi que voc√™ recebeu a mensagem, mas ainda n√£o respondeu. Quer tirar alguma d√∫vida ante
Hor√°rio Agendado: 2025-03-25T00:13:16.514Z
Metadata: {
  "template_name": "novo_lead_10min",
  "category": "Utility",
  "stage_name": "Etapa 1",
  "clientName": "58",
  "templateParams": {
    "name": "novo_lead_10min",
    "category": "Utility",
    "language": "pt_BR"
  },
  "processedParams": {
    "1": "58"
  }
}
Atraso calculado: 29989ms (29.989 segundos)
Agendando mensagem para daqui a 29.989 segundos
Timeout armazenado com sucesso para mensagem 9c237132-0de0-4946-aba5-8ee21ea66e2e-0
Mensagem para o passo 0 agendada com sucesso
Pr√≥ximo passo: novo_lead_30min, tempo de espera: 30000ms
Agendando pr√≥ximo passo 1 para follow-up 9c237132-0de0-4946-aba5-8ee21ea66e2e com delay de 30000ms
Recarregando 1 follow-ups ativos com mensagens pendentes
===== LOG DE AGENDAMENTO DE MENSAGEM =====
FollowUp ID: 9c237132-0de0-4946-aba5-8ee21ea66e2e
Step Index: 0
Cliente ID: 58
Conte√∫do: "Ei, Boss! üöÄ Vi que voc√™ recebeu a mensagem, mas ainda n√£o respondeu. Quer tirar alguma d√∫vida ante
Hor√°rio Agendado: 2025-03-25T00:13:16.514Z
Metadata: {
  "template_name": "novo_lead_10min",
  "category": "Utility",
  "stage_name": "Etapa 1"
}
Cancelando timeout existente para mensagem 9c237132-0de0-4946-aba5-8ee21ea66e2e-0
Atraso calculado: 26926ms (26.926 segundos)
Agendando mensagem para daqui a 26.926 segundos
Timeout armazenado com sucesso para mensagem 9c237132-0de0-4946-aba5-8ee21ea66e2e-0
Reagendado envio da mensagem do passo 0 para follow-up 9c237132-0de0-4946-aba5-8ee21ea66e2e
Executando timeout para mensagem 9c237132-0de0-4946-aba5-8ee21ea66e2e-0
===== LOG DE ENVIO DE MENSAGEM =====
FollowUp ID: 9c237132-0de0-4946-aba5-8ee21ea66e2e
Step Index: 0
Cliente ID: 58
Status do follow-up: active
Enviando mensagem via API Lumibot
Template: novo_lead_10min
Categoria: Utility
===== REQUISI√á√ÉO GET CONVERSA DO CLIENTE =====
Cliente ID: 58
Endpoint: https://app.lumibot.com.br/api/v1/accounts/10/conversations/58
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Processando passo 1 (Etapa 1)
Modo de teste: convertendo tempo "30 minutos" para 30 segundos para testes
===== LOG DE AGENDAMENTO DE MENSAGEM =====
FollowUp ID: 9c237132-0de0-4946-aba5-8ee21ea66e2e
Step Index: 1
Cliente ID: 58
Conte√∫do: Oi, {{1}}! Percebi que seu atendimento ainda est√° em andamento. Sei que a rotina pode ser corrida, e
Hor√°rio Agendado: 2025-03-25T00:13:46.553Z
Metadata: {
  "template_name": "novo_lead_30min",
  "category": "Utility",
  "stage_name": "Etapa 1",
  "clientName": "58",
  "templateParams": {
    "name": "novo_lead_30min",
    "category": "Utility",
    "language": "pt_BR"
  },
  "processedParams": {
    "1": "58"
  }
}
Atraso calculado: 29991ms (29.991 segundos)
Agendando mensagem para daqui a 29.991 segundos
Timeout armazenado com sucesso para mensagem 9c237132-0de0-4946-aba5-8ee21ea66e2e-1
Mensagem para o passo 1 agendada com sucesso
Follow-up 9c237132-0de0-4946-aba5-8ee21ea66e2e - √öltimo passo do est√°gio, aguardando resposta antes de avan√ßar para Etapa 2
Follow-up 9c237132-0de0-4946-aba5-8ee21ea66e2e - Preparando transi√ß√£o para o pr√≥ximo est√°gio: Etapa 2
Follow-up 9c237132-0de0-4946-aba5-8ee21ea66e2e - Existem 2 mensagens pendentes no est√°gio "Etapa 1". Pausando para aguardar envio completo.
===== RESPOSTA GET CONVERSA DO CLIENTE =====
Status: 200
Detalhes do envio para Lumibot:
- clientId: 58
- templateName: novo_lead_10min
- category: Utility
===== RESPOSTA DA API LUMIBOT =====
Status: 200
Resultado do envio via Lumibot: SUCESSO
Atualizando mensagem como entregue no banco de dados
Mensagem marcada como entregue com sucesso
Timeout removido do mapa: 9c237132-0de0-4946-aba5-8ee21ea66e2e-0
Executando timeout para mensagem 9c237132-0de0-4946-aba5-8ee21ea66e2e-1
===== LOG DE ENVIO DE MENSAGEM =====
FollowUp ID: 9c237132-0de0-4946-aba5-8ee21ea66e2e
Step Index: 1
Cliente ID: 58
Status do follow-up: active
Enviando mensagem via API Lumibot
Template: novo_lead_30min
Categoria: Utility
===== REQUISI√á√ÉO GET CONVERSA DO CLIENTE =====
Cliente ID: 58
Endpoint: https://app.lumibot.com.br/api/v1/accounts/10/conversations/58
===== RESPOSTA GET CONVERSA DO CLIENTE =====
Status: 200
Detalhes do envio para Lumibot:
- clientId: 58
- templateName: novo_lead_30min
- category: Utility
===== RESPOSTA DA API LUMIBOT =====
Status: 200
Resultado do envio via Lumibot: SUCESSO
Atualizando mensagem como entregue no banco de dados
Mensagem marcada como entregue com sucesso
Todas as mensagens do est√°gio "Etapa 1" foram entregues, retomando transi√ß√£o de est√°gio
Timeout removido do mapa: 9c237132-0de0-4946-aba5-8ee21ea66e2e-1
Retomando transi√ß√£o de est√°gio para follow-up 9c237132-0de0-4946-aba5-8ee21ea66e2e ap√≥s entrega de todas as mensagens
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Processando passo 2 (Etapa 2)
Modo de teste: convertendo tempo "30 minutos" para 30 segundos para testes
===== LOG DE AGENDAMENTO DE MENSAGEM =====
FollowUp ID: 9c237132-0de0-4946-aba5-8ee21ea66e2e
Step Index: 2
Cliente ID: 58
Conte√∫do: Oi, {{1}}! Vi que voc√™ iniciou um processo conosco, mas ainda n√£o conclu√≠mos sua qualifica√ß√£o. Caso 
Hor√°rio Agendado: 2025-03-25T00:14:18.210Z
Metadata: {
  "template_name": "qualificacao_10min",
  "category": "Utility",
  "stage_name": "Etapa 2",
  "clientName": "58",
  "templateParams": {
    "name": "qualificacao_10min",
    "category": "Utility",
    "language": "pt_BR"
  },
  "processedParams": {
    "1": "58"
  }
}
Atraso calculado: 29993ms (29.993 segundos)
Agendando mensagem para daqui a 29.993 segundos
Timeout armazenado com sucesso para mensagem 9c237132-0de0-4946-aba5-8ee21ea66e2e-2
Mensagem para o passo 2 agendada com sucesso
Pr√≥ximo passo: qualificacao_1h, tempo de espera: 30000ms
Agendando pr√≥ximo passo 3 para follow-up 9c237132-0de0-4946-aba5-8ee21ea66e2e com delay de 30000ms
 ‚óã Compiling /api/follow-up/client-response ...
 ‚úì Compiled /api/follow-up/client-response in 866ms
=== DADOS DA RESPOSTA DO CLIENTE ===
followUpId: 9c237132-0de0-4946-aba5-8ee21ea66e2e
clientId: 58
message: Ol√°, estou testando o avan√ßo de est√°gio!
=== FIM DADOS DA RESPOSTA DO CLIENTE ===
=== DADOS DA RESPOSTA DO CLIENTE ===
{
  followUpId: '9c237132-0de0-4946-aba5-8ee21ea66e2e',
  clientId: '58',
  message: 'Ol√°, estou testando o avan√ßo de est√°gio!'
}
=== FIM DADOS DA RESPOSTA DO CLIENTE ===
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Follow-up 9c237132-0de0-4946-aba5-8ee21ea66e2e - Existem 1 mensagens pendentes no est√°gio atual. Registrando resposta, mas mantendo o est√°gio.
 POST /api/follow-up/client-response 200 in 994ms
 ‚óã Compiling /api/follow-up/status ...
 ‚úì Compiled /api/follow-up/status in 559ms
 GET /api/follow-up/status?id=9c237132-0de0-4946-aba5-8ee21ea66e2e 200 in 615ms
Executando timeout para mensagem 9c237132-0de0-4946-aba5-8ee21ea66e2e-2
===== LOG DE ENVIO DE MENSAGEM =====
FollowUp ID: 9c237132-0de0-4946-aba5-8ee21ea66e2e
Step Index: 2
Cliente ID: 58
Status do follow-up: active
Enviando mensagem via API Lumibot
Template: qualificacao_10min
Categoria: Utility
===== REQUISI√á√ÉO GET CONVERSA DO CLIENTE =====
Cliente ID: 58
Endpoint: https://app.lumibot.com.br/api/v1/accounts/10/conversations/58
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Processando passo 3 (Etapa 2)
Modo de teste: convertendo tempo "30 minutos" para 30 segundos para testes
===== LOG DE AGENDAMENTO DE MENSAGEM =====
FollowUp ID: 9c237132-0de0-4946-aba5-8ee21ea66e2e
Step Index: 3
Cliente ID: 58
Conte√∫do: Boss! Para te ajudar com mais informa√ß√µes, preparamos um v√≠deo explicativo sobre como funciona. Voc√™
Hor√°rio Agendado: 2025-03-25T00:14:48.232Z
Metadata: {
  "template_name": "qualificacao_1h",
  "category": "Utility",
  "stage_name": "Etapa 2",
  "clientName": "58",
  "templateParams": {
    "name": "qualificacao_1h",
    "category": "Utility",
    "language": "pt_BR"
  },
  "processedParams": {
    "1": "58"
  }
}
Atraso calculado: 29992ms (29.992 segundos)
Agendando mensagem para daqui a 29.992 segundos
Timeout armazenado com sucesso para mensagem 9c237132-0de0-4946-aba5-8ee21ea66e2e-3
Mensagem para o passo 3 agendada com sucesso
Follow-up 9c237132-0de0-4946-aba5-8ee21ea66e2e - √öltimo passo do est√°gio, aguardando resposta antes de avan√ßar para Etapa 3
Follow-up 9c237132-0de0-4946-aba5-8ee21ea66e2e - Preparando transi√ß√£o para o pr√≥ximo est√°gio: Etapa 3
Follow-up 9c237132-0de0-4946-aba5-8ee21ea66e2e - Existem 2 mensagens pendentes no est√°gio "Etapa 2". Pausando para aguardar envio completo.
===== RESPOSTA GET CONVERSA DO CLIENTE =====
Status: 200
Detalhes do envio para Lumibot:
- clientId: 58
- templateName: qualificacao_10min
- category: Utility
===== RESPOSTA DA API LUMIBOT =====
Status: 200
Resultado do envio via Lumibot: SUCESSO
Atualizando mensagem como entregue no banco de dados
Mensagem marcada como entregue com sucesso
Timeout removido do mapa: 9c237132-0de0-4946-aba5-8ee21ea66e2e-2
 GET /api/follow-up/status?id=9c237132-0de0-4946-aba5-8ee21ea66e2e 200 in 66ms
Executando timeout para mensagem 9c237132-0de0-4946-aba5-8ee21ea66e2e-3
===== LOG DE ENVIO DE MENSAGEM =====
FollowUp ID: 9c237132-0de0-4946-aba5-8ee21ea66e2e
Step Index: 3
Cliente ID: 58
Status do follow-up: active
Enviando mensagem via API Lumibot
Template: qualificacao_1h
Categoria: Utility
===== REQUISI√á√ÉO GET CONVERSA DO CLIENTE =====
Cliente ID: 58
Endpoint: https://app.lumibot.com.br/api/v1/accounts/10/conversations/58
===== RESPOSTA GET CONVERSA DO CLIENTE =====
Status: 200
Detalhes do envio para Lumibot:
- clientId: 58
- templateName: qualificacao_1h
- category: Utility
===== RESPOSTA DA API LUMIBOT =====
Status: 200
Resultado do envio via Lumibot: SUCESSO
Atualizando mensagem como entregue no banco de dados
Mensagem marcada como entregue com sucesso
Todas as mensagens do est√°gio "Etapa 2" foram entregues, retomando transi√ß√£o de est√°gio
Timeout removido do mapa: 9c237132-0de0-4946-aba5-8ee21ea66e2e-3
Retomando transi√ß√£o de est√°gio para follow-up 9c237132-0de0-4946-aba5-8ee21ea66e2e ap√≥s entrega de todas as mensagens
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Processando passo 4 (Etapa 3)
Modo de teste: convertendo tempo "30 minutos" para 30 segundos para testes
===== LOG DE AGENDAMENTO DE MENSAGEM =====
FollowUp ID: 9c237132-0de0-4946-aba5-8ee21ea66e2e
Step Index: 4
Cliente ID: 58
Conte√∫do: üîî Toc, toc, {{1}}! N√£o quero parecer insistente, mas a hora √© agora! Sua oportunidade est√° aberta e
Hor√°rio Agendado: 2025-03-25T00:15:19.840Z
Metadata: {
  "template_name": "qualificado_20mn",
  "category": "Marketing",
  "stage_name": "Etapa 3",
  "clientName": "58",
  "templateParams": {
    "name": "qualificado_20mn",
    "category": "Marketing",
    "language": "pt_BR"
  },
  "processedParams": {
    "1": "58"
  }
}
Atraso calculado: 29994ms (29.994 segundos)
Agendando mensagem para daqui a 29.994 segundos
Timeout armazenado com sucesso para mensagem 9c237132-0de0-4946-aba5-8ee21ea66e2e-4
Mensagem para o passo 4 agendada com sucesso
Pr√≥ximo passo: qualificado_1h, tempo de espera: 30000ms
Agendando pr√≥ximo passo 5 para follow-up 9c237132-0de0-4946-aba5-8ee21ea66e2e com delay de 30000ms
 GET /api/follow-up/status?id=9c237132-0de0-4946-aba5-8ee21ea66e2e 200 in 71ms
 GET /api/follow-up/status?id=9c237132-0de0-4946-aba5-8ee21ea66e2e 200 in 60ms
Executando timeout para mensagem 9c237132-0de0-4946-aba5-8ee21ea66e2e-4
===== LOG DE ENVIO DE MENSAGEM =====
FollowUp ID: 9c237132-0de0-4946-aba5-8ee21ea66e2e
Step Index: 4
Cliente ID: 58
Status do follow-up: active
Enviando mensagem via API Lumibot
Template: qualificado_20mn
Categoria: Marketing
===== REQUISI√á√ÉO GET CONVERSA DO CLIENTE =====
Cliente ID: 58
Endpoint: https://app.lumibot.com.br/api/v1/accounts/10/conversations/58
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Modo de teste: reduzindo tempo de espera de 1800000ms para 30 segundos
Processando passo 5 (Etapa 3)
Modo de teste: convertendo tempo "30 minutos" para 30 segundos para testes
===== LOG DE AGENDAMENTO DE MENSAGEM =====
FollowUp ID: 9c237132-0de0-4946-aba5-8ee21ea66e2e
Step Index: 5
Cliente ID: 58
Conte√∫do: {{1}}, quem avisa amiga √©! Outras pessoas j√° est√£o aproveitando essa chance e colhendo resultados. S
Hor√°rio Agendado: 2025-03-25T00:15:49.860Z
Metadata: {
  "template_name": "qualificado_1h",
  "category": "Marketing",
  "stage_name": "Etapa 3",
  "clientName": "58",
  "templateParams": {
    "name": "qualificado_1h",
    "category": "Marketing",
    "language": "pt_BR"
  },
  "processedParams": {
    "1": "58"
  }
}
Atraso calculado: 29993ms (29.993 segundos)
Agendando mensagem para daqui a 29.993 segundos
Timeout armazenado com sucesso para mensagem 9c237132-0de0-4946-aba5-8ee21ea66e2e-5
Mensagem para o passo 5 agendada com sucesso
Follow-up 9c237132-0de0-4946-aba5-8ee21ea66e2e - Todos os passos foram processados
Follow-up 9c237132-0de0-4946-aba5-8ee21ea66e2e atualizado para status: completed
===== RESPOSTA GET CONVERSA DO CLIENTE =====
Status: 200
Detalhes do envio para Lumibot:
- clientId: 58
- templateName: qualificado_20mn
- category: Marketing
===== RESPOSTA DA API LUMIBOT =====
Status: 200
Resultado do envio via Lumibot: SUCESSO
Atualizando mensagem como entregue no banco de dados
Mensagem marcada como entregue com sucesso
Timeout removido do mapa: 9c237132-0de0-4946-aba5-8ee21ea66e2e-4
 GET /api/follow-up/status?id=9c237132-0de0-4946-aba5-8ee21ea66e2e 200 in 64ms
Executando timeout para mensagem 9c237132-0de0-4946-aba5-8ee21ea66e2e-5
===== LOG DE ENVIO DE MENSAGEM =====
FollowUp ID: 9c237132-0de0-4946-aba5-8ee21ea66e2e
Step Index: 5
Cliente ID: 58
Status do follow-up: completed
Follow-up n√£o est√° ativo, cancelando envio
Timeout removido do mapa: 9c237132-0de0-4946-aba5-8ee21ea66e2e-5