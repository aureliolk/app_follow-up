<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Socket.IO</title>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
</head>
<body>
    <h1>Teste de Conexão Socket.IO</h1>
    <div>
        <button id="connect">Conectar</button>
        <button id="disconnect" disabled>Desconectar</button>
        <button id="send-ping" disabled>Enviar Ping</button>
        <button id="join-workspace" disabled>Entrar na Sala Workspace</button>
    </div>
    <div>Status: <span id="status">Desconectado</span></div>
    <div>ID da Conexão: <span id="connection-id">-</span></div>
    <div>Último Ping: <span id="last-ping">-</span></div>
    <div style="margin-top: 20px;">
        <h3>Log de Eventos:</h3>
        <pre id="log" style="height: 300px; overflow-y: auto; background-color: #f5f5f5; padding: 10px; border-radius: 5px;"></pre>
    </div>

    <script>
        let socket = null;
        
        function log(message) {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toISOString();
            logElement.innerHTML += `${timestamp} - ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        document.getElementById('connect').addEventListener('click', () => {
            try {
                socket = io('http://localhost:3001', {
                    transports: ['websocket', 'polling'],
                    reconnectionAttempts: 3,
                    reconnectionDelay: 1000,
                    timeout: 5000
                });

                socket.on('connect', () => {
                    document.getElementById('status').textContent = 'Conectado';
                    document.getElementById('connection-id').textContent = socket.id;
                    document.getElementById('connect').disabled = true;
                    document.getElementById('disconnect').disabled = false;
                    document.getElementById('send-ping').disabled = false;
                    document.getElementById('join-workspace').disabled = false;
                    log(`Conectado com ID: ${socket.id}`);
                });

                socket.on('disconnect', (reason) => {
                    document.getElementById('status').textContent = `Desconectado (${reason})`;
                    document.getElementById('connection-id').textContent = '-';
                    document.getElementById('connect').disabled = false;
                    document.getElementById('disconnect').disabled = true;
                    document.getElementById('send-ping').disabled = true;
                    document.getElementById('join-workspace').disabled = true;
                    log(`Desconectado. Motivo: ${reason}`);
                });

                socket.on('connect_error', (error) => {
                    log(`Erro de conexão: ${error.message}`);
                });

                socket.on('error', (error) => {
                    log(`Erro: ${error}`);
                });

                socket.on('welcome', (data) => {
                    log(`Mensagem de boas-vindas: ${JSON.stringify(data)}`);
                });

                socket.on('pong', (data) => {
                    document.getElementById('last-ping').textContent = data.timestamp;
                    log(`Pong recebido: ${JSON.stringify(data)}`);
                });

                socket.on('workspace_joined', (workspaceId) => {
                    log(`Entrou na sala do workspace: ${workspaceId}`);
                });

                socket.on('test_event', (data) => {
                    log(`Evento de teste recebido: ${JSON.stringify(data)}`);
                });

            } catch (error) {
                log(`Erro ao criar socket: ${error.message}`);
            }
        });

        document.getElementById('disconnect').addEventListener('click', () => {
            if (socket) {
                socket.disconnect();
            }
        });

        document.getElementById('send-ping').addEventListener('click', () => {
            if (socket && socket.connected) {
                log('Enviando ping para o servidor...');
                socket.emit('ping', (response) => {
                    document.getElementById('last-ping').textContent = response.timestamp;
                    log(`Resposta do ping: ${JSON.stringify(response)}`);
                });
            } else {
                log('Não conectado ao servidor');
            }
        });

        document.getElementById('join-workspace').addEventListener('click', () => {
            if (socket && socket.connected) {
                const workspaceId = '5207c77e-e038-4a5d-8bd2-e4263809a534'; // ID de exemplo
                log(`Tentando entrar na sala do workspace: ${workspaceId}`);
                socket.emit('join_workspace', workspaceId);
            } else {
                log('Não conectado ao servidor');
            }
        });
    </script>
</body>
</html> 